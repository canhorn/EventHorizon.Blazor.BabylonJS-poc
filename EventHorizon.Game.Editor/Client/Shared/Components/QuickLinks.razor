@using EventHorizon.Game.Editor.Client.Authentication.Api
@using EventHorizon.Game.Editor.Client.Authentication.Set
@using EventHorizon.Game.Editor.Client.Shared.Components.TreeView.Model

<TreeView Root="@QuickLinkData" OnChanged="HandleTreeViewChanged" />

@code {
    [CascadingParameter]
    public SessionValues SessionValues { get; set; } = null!;

    [Inject]
    public MediatR.IMediator Mediator { get; set; } = null!;

    [Inject]
    public Localizer<SharedResource> Localizer { get; set; } = null!;

    public TreeViewNodeData QuickLinkData { get; set; } = new TreeViewNodeData();

    protected override void OnInitialized()
    {
        base.OnInitialized();

        QuickLinkData = new TreeViewNodeData
        {
            Name = "pages",
            Text = Localizer["Quick Links"],
            IsExpanded = (SessionValues.Get("quickLinks_IsExpanded", string.Empty) == "true"),
            Children = new List<TreeViewNodeData>
{
                new TreeViewNodeData
                {
                    Name = "zone-entity",
                    Text = Localizer["Entity Editor"],
                    Href = "/zone/entity",
                    IconCssClass = "--icon oi oi-list-rich"
                },
                new TreeViewNodeData
                {
                    Name = "live-editor",
                    Text = Localizer["Live Editor"],
                    Href = "/live-editor",
                    IconCssClass = "--icon oi oi-list-rich"
                },
                new TreeViewNodeData
                {
                    Name = "zone-commands",
                    Text = Localizer["Zone Commands"],
                    Href = "/zone/commands",
                    IconCssClass = "--icon oi oi-list-rich"
                },
                new TreeViewNodeData
                {
                    Name = "wizard-editor",
                    Text = Localizer["Wizard"],
                    Href = "/wizard-editor",
                    IconCssClass = "--icon oi oi-list-rich"
                },
            }
        };
    }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        QuickLinkData.IsExpanded = (SessionValues.Get("quickLinks_IsExpanded", string.Empty) == "true");
    }

    private Task HandleTreeViewChanged()
    {
        return Mediator.Send(
            new SetSessionValueCommand(
                "quickLinks_IsExpanded",
                QuickLinkData.IsExpanded ? "true" : string.Empty
            )
        );
    }
}
